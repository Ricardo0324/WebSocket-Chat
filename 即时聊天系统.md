### 一 登录注销

#### 1.1 登录

后端接收到邮箱和密码。先按照email在`user`表中查出对应的user。如果user为空，向前端返回邮箱未注册；接着判断表中的password字段是否跟前端传入的一致，不一致则向前端返回密码错误。一致则进行聊天界面的跳转。

#### 1.2 注册

##### 1.2.1 验证码

用户输入邮箱，点击获取验证码。后端先根据email在数据库中查询，如果`user`表中存在该email，则向前端返回邮箱已注册。然后根据email向`verifycode`表中查询是否有对应的验证码。如果有就先清空，然后生成新的验证码与email对应存在`verifycode`表中。接着通过QQ邮箱的SMTP服务将验证码发送给用户的email。

##### 1.2.2 提交

后端接收到用户提交的昵称，邮箱，密码，验证码字段。首先根据email检查验证码是否和`verifycode`表中一致。不一致返回验证码不正确。一致则将数据插入到`user`表中，并返回注册成功。

#### 1.3 注销登录

调用session中的方法。删除对应的user。并且跳转到登陆界面。

### 二 通知

#### 2.1 获取好友列表

通过当前登录用户的id在`friend`表中查到对应的好友id。再通过好友id从`user`表中查询完整信息，封装到List中返回给前端渲染。

#### 2.2 发送好友申请

后台接收三个参数。from是发送用户的id；to是目标用户的id；msg是备注的内容。将这三个参数以及封装到notice对象中，然后插入到`notice`表中。表中type字段表示通知的状态：0表示未读，1表示同意，2表示拒绝。

#### 2.3 获取通知

后台接收到当前用户的id。将这个id作为条件放到`notice`表中to字段做查询。将所有to字段为用户id的notice对象封装成List返回前端。

#### 2.4 同意好友申请

用户点击同意后，向后端传递用户id和通知id两个字段。然后将`notice`表中的from和to两个用户id插入到`friend`表中。让他们两个好友相互绑定。然后将当前通知中的from和to字段对换，并把type设置为1，告知对方已经通过申请。

#### 2.5 删除通知

用户点击删除后，同样向后端传递用户id和通知id两个字段。通过通知id在`notice`表中查询当前状态type。然后根据通知id进行删除。

### 三 聊天

#### 3.1 查看当前在线用户

每个用户登录后，用户id会存在socket中的ids中。前端通过获取ids传递到后端。后端遍历ids，从`user`表中搜索出对应的user对象，并且封装成List类型传递给前端。

#### 3.2 获取聊天记录

用户点击好友的头像时，会向后端传递自己的id和点击好友的id。后端根据两个id在`message`表中查询from和to字段中拥有这两个id的全部内容，并从上至下以message对象封装成List返回。

#### 3.3 保存聊天记录

后端接收到三个参数：from(发送者id)，to(接收者id)，content(聊天内容)。前端websocket将聊天内容转发后，后端把三个参数插入到`message`表中。

#### 3.4 清空聊天记录

后端接收两个参数，自己的id和好友的id。通过这两个字段从`message`表中搜索from和to字段所对应的字段，遍历进行删除。

### 四 好友管理

#### 4.1 搜索好友

用户可以根据昵称和email进行模糊搜索。后端接收到keyword之后，在`user`表中搜索对应的用户信息，封装成User对象后返回前端。

#### 4.2 删除好友

后端接收到当前用户的id和即将删除好友的id。然后将`friend`表中的对应好友关系删除。

### 五 个人信息

#### 5.1 获取我的信息

#### 5.2 修改我的信息

#### 5.3 更换头像

#### 5.4 更换密码